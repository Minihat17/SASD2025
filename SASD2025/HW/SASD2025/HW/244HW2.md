สรุปเรื่อง Code Smell: Incomplete Library Class

เนื้อหาสรุปประเด็นสำคัญ 4 ด้าน เกี่ยวกับปัญหาคลาสห้องสมุดที่ไม่สมบูรณ์
1. Incomplete Library Class คืออะไร?
มันคือสถานการณ์ที่เราไปเอา Library ของคนอื่นมาใช้ (ซึ่งเราแก้ Code เขาไม่ได้) แล้วพบว่าคลาสนั้นมันดัน **"ขาดฟังก์ชันบางอย่าง"** ที่เราจำเป็นต้องใช้จริงๆ 
**ทำไมถึงเป็นปัญหา?** เพราะพอมันไม่มีให้ เราก็ต้องเขียน Logic นั้นเองข้างนอก พอทำบ่อยๆ เข้า โค้ดที่ควรจะอยู่รวมกันในคลาสเดียว มันกลับกระจายไปอยู่ตาม Controller หรือ Service ต่างๆ ทำให้โค้ดเราดูรกและจัดการยาก (Poor Encapsulation)
2. ตัวอย่างโค้ดตอนที่ยังมีปัญหา (The Smell)
สมมติใช้ Library จัดการเรื่องวันเวลา แต่ดันไม่มี Method เช็คว่าเป็นวันหยุดไหม เราเลยต้องมานั่งเขียน if-else เองทุกรอบที่เรียกใช้:
// ต้องมาเขียนเช็คเองทุกที่ที่ต้องการรู้ว่าเป็นวันเสาร์-อาทิตย์ไหม
Date appointment = getBookingDate();
// Logic นี้โผล่มากลางทางบ่อยๆ ถือเป็น Code Smell
if (appointment.getDay() == 0 || appointment.getDay() == 6) {
    throw new Exception("Library ไม่มีเมธอดเช็ควันหยุด เราเลยต้องเขียนเองแบบนี้");
}
3. วิธีแก้ (Refactoring)
ทางแก้ที่นิยมคือการทำ Local Extension หรือสร้าง Wrapper ขึ้นมาครอบคลาสเดิมไว้ แล้วยัดฟังก์ชันที่ขาดไปใส่ลงไปในคลาสใหม่ของเราแทน:
Java
// สร้างคลาสใหม่มาหุ้มตัวเดิมไว้ (Wrapper)
public class SmartDate {
    private final Date date;

    public SmartDate(Date date) {
        this.date = date;
    }

    // ย้าย Logic ที่กระจัดกระจายมาไว้ที่นี่ที่เดียว
    public boolean isWeekend() {
        return date.getDay() == 0 || date.getDay() == 6;
    }
}

// เวลาเรียกใช้จริง โค้ดจะคลีนขึ้นมาก:
SmartDate day = new SmartDate(appointment);
if (day.isWeekend()) { 
    /* สั้น ง่าย ไม่ต้องเขียน Logic ซ้ำ */ 
}
4. เมื่อไหร่ที่ไม่ต้องแก้ก็ได้? (Exception)
ไม่ใช่ว่าทุกอย่างต้อง Refactor เสมอไป เราจะปล่อยมันไว้ก็ได้ถ้า:
ใช้น้อยมาก: ถ้าทั้งโปรเจกต์มีจุดที่ต้องเช็คแค่ที่เดียว การสร้างคลาสใหม่ครอบอาจจะดูเยอะเกินไป (Over-engineering)
Library กำลังจะอัปเดต: ถ้ารู้ว่าเวอร์ชันหน้าเขากำลังจะเพิ่มฟังก์ชันนี้ให้แล้ว เราก็เขียนแก้ขัดไปก่อนได้ ไม่ต้องลงทุนสร้างโครงสร้างใหม่
Logic เฉพาะทางเกินไป: ถ้าฟังก์ชันนั้นมัน "เฉพาะ" สำหรับงานเรางานเดียว ไม่ใช่ความสามารถทั่วไปที่ Library ควรจะมี การเขียนแยกไว้ข้างนอกก็เมคเซนส์กว่า
